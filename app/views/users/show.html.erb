<%
  content_for(:title, "Profil de #{@user.username}")
  content_for(:description, @user.bio)
%>
<section class="p-8 lg:flex lg:space-x-6">
  <header class="lg:w-2/6">
    <!-- user title -->
    <div class="mb-6 flex space-x-3">
      <%= render partial: "users/avatar", locals: {
        user: @user,
        size: :xlarge
      } %>
      <div class="">
        <div class="flex space-x-3 justify-between">
          <h1 class="flex-1 text-3xl font-bold text-gray-900 m-0 mb-3">
            <%= @user.username %>
          </h1>
          <% if current_user.present? && current_user != @user %>
            <%# = render partial: "users/friendships/friendship_with_current_user", locals: {user: @user} %>
            <%= render partial: "users/follows/bell", locals: {user: @user} %>
          <% end %>
        </div>
        <ul class="flex space-x-3 justify-between text-center">
          <li>
            <span class="font-bold text-xl block"><%= @user.followers.count %></span>
            Suiveurs
          </li>
          <li>
            <span class="font-bold text-xl block"><%= @user.following.count %></span>
            Suivis
          </li>
          <li>
            <span class="font-bold text-xl block"><%= @user.exercises.count %></span>
            Exercices postés
          </li>
        </ul>
      </div>
    </div>
    <!-- user title -->

    <!-- relation -->
    <% if @user.followers.present? %>
      <div class="mb-6">
        <h2 class="font-medium text-gray-500 mb-3">
          Ces personnes le suivent
        </h2>
        <%#= render partial: "users/friendships/preview-list", locals: {user: @user} %>
        <%= render partial: "users/follows/preview-list", locals: {user: @user} %>
      </div>
    <% end %>
    <!-- relation -->

    <!-- more about -->
    <div class="mb-6">
      <header class="flex space-x-3 mb-3">
        <h2 class="flex-1 font-medium text-gray-500">
          Bio et autres informations
        </h2>
        <% if current_user.present? && @user == current_user %>
          <%= link_to edit_user_registration_path(current_user), class: "block" do %>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
              <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" />
            </svg>
          <% end %>
        <% end %>
      </header>
      <div class="bg-gray-100 p-4 rounded">
        <p class="mb-3">
          <%= @user.bio %>
        </p>
        <p class="text-sm text-gray-500">
          Membre depuis <%= @user.created_at %>
        </p>
      </div>
    </div>
    <!-- more about -->
  </header>

  <section class="lg:flex-1 lg:w-4/6">
    <!-- Derniers exercices -->
    <article class="">
      <header class="flex space-x-4 mb-6">
        <h2 class="text-xl font-medium leading-6 flex-1">
          Derniers exercices publiés sur la plateforme
        </h2>
        <p class="flex-shrink-0">Voir tous</p>
      </header>

      <% if @user.exercises.for_current_user(current_user) %>
        <%= render layout: 'shared/tiles_list', locals: {
          items: @user.exercises.for_current_user(current_user).map do |exercise|
            {
              icon: '
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                </svg>
              ',
              title: link_to(exercise.title, exercise_path(exercise.id)),
              description: exercise.description,
              origin_data: exercise
            }
          end
        } do |item| %>
          <% if can? :manage, item[:origin_data] %>
            <a href="<%= edit_exercise_path(item[:origin_data]) %>" class="block btn btn-link" title="Editer l'exercice">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" />
              </svg>
            </a>
          <% end %>
        <% end %>
      <% else %>
        <p>Aucun exercice publié par cet utilisateur pour le moment.</p>
      <% end %>
    </article>
  </section>
</section>

